<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mind Map</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #fff8f0;
        overflow: hidden;
      }
      #mindmap {
        width: 100vw;
        height: 100vh;
      }
      svg {
        width: 100%;
        height: 100%;
      }
      .markmap-node {
        cursor: pointer;
      }
      .markmap-node-circle {
        fill: #c41e3a;
      }
      .markmap-node-text {
        fill: #1a1a1a;
        font-size: 16px;
        font-weight: 500;
      }
      .markmap-link {
        stroke: #d4af37;
        stroke-width: 2;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-view@0.15.4"></script>
  </head>
  <body>
    <svg id="mindmap"></svg>

    <script>
      const data = {
        type: "heading",
        depth: 0,
        content: "ðŸŽ¯ Giai cáº¥p & Äáº¥u tranh giai cáº¥p",
        children: [
          {
            type: "heading",
            depth: 1,
            content: "ðŸ“Œ Giai cáº¥p",
            payload: {
              tooltip: "Äá»‹nh nghÄ©a, Ä‘áº·c trÆ°ng vÃ  thá»±c cháº¥t quan há»‡ giai cáº¥p.",
              link: "/lesson/giai-cap",
            },
          },
          {
            type: "heading",
            depth: 1,
            content: "ðŸ“Œ Nguá»“n gá»‘c",
            payload: {
              tooltip:
                "Nguá»“n gá»‘c sÃ¢u xa vÃ  trá»±c tiáº¿p; con Ä‘Æ°á»ng hÃ¬nh thÃ nh; Ä‘iá»u kiá»‡n phÃ¢n hÃ³a.",
              link: "/lesson/nguon-goc-giai-cap",
            },
          },
          {
            type: "heading",
            depth: 1,
            content: "ðŸ“Œ Káº¿t cáº¥u xÃ£ há»™i â€“ giai cáº¥p",
            payload: {
              tooltip:
                "ThÃ nh pháº§n giai cáº¥p cÆ¡ báº£n, khÃ´ng cÆ¡ báº£n, táº§ng lá»›p xÃ£ há»™i; tÃ­nh váº­n Ä‘á»™ng.",
              link: "/lesson/ket-cau-xa-hoi-giai-cap",
            },
          },
          {
            type: "heading",
            depth: 1,
            content: "ðŸ“Œ Äáº¥u tranh giai cáº¥p",
            payload: {
              tooltip:
                "Äá»‹nh nghÄ©a, tÃ­nh táº¥t yáº¿u, Ä‘áº·c trÆ°ng, vai trÃ² cá»§a Ä‘áº¥u tranh giai cáº¥p.",
              link: "/lesson/dau-tranh-giai-cap",
            },
            children: [
              {
                type: "heading",
                depth: 2,
                content: "ðŸ“Œ Vai trÃ²",
                payload: {
                  tooltip:
                    "Äá»™ng lá»±c trá»±c tiáº¿p cá»§a lá»‹ch sá»­ cÃ¡c xÃ£ há»™i cÃ³ giai cáº¥p.",
                  link: "/lesson/dau-tranh-giai-cap",
                },
              },
              {
                type: "heading",
                depth: 2,
                content: "ðŸ“Œ Äáº¥u tranh vÃ´ sáº£n",
                payload: {
                  tooltip:
                    "Ba hÃ¬nh thá»©c Ä‘áº¥u tranh trÆ°á»›c khi giÃ nh chÃ­nh quyá»n; nhiá»‡m vá»¥ sau khi giÃ nh chÃ­nh quyá»n.",
                  link: "/lesson/dau-tranh-vo-san",
                },
                children: [
                  {
                    type: "heading",
                    depth: 3,
                    content: "ðŸ“Œ Thá»i ká»³ quÃ¡ Ä‘á»™",
                    payload: {
                      tooltip:
                        "Ná»™i dung, hÃ¬nh thá»©c Ä‘áº¥u tranh thá»i ká»³ quÃ¡ Ä‘á»™ lÃªn CNXH.",
                      link: "/lesson/dau-tranh-vo-san",
                    },
                    children: [
                      {
                        type: "heading",
                        depth: 4,
                        content: "ðŸ“Œ Viá»‡t Nam quÃ¡ Ä‘á»™",
                        payload: {
                          tooltip:
                            "Äáº·c Ä‘iá»ƒm, nhiá»‡m vá»¥, hÃ¬nh thá»©c Ä‘áº¥u tranh giai cáº¥p thá»i ká»³ quÃ¡ Ä‘á»™ á»Ÿ Viá»‡t Nam.",
                          link: "/lesson/thoi-ky-qua-do-viet-nam",
                        },
                      },
                    ],
                  },
                ],
              },
            ],
          },
        ],
      };

      const { Markmap, loadCSS, loadJS } = window.markmap;

      // Initialize markmap
      const svg = document.getElementById("mindmap");
      const mm = Markmap.create(svg, {
        color: (node) => {
          const colors = ["#c41e3a", "#d4af37", "#8b1a2b", "#b8860b"];
          return colors[node.state.depth % colors.length];
        },
        paddingX: 20,
        spacingVertical: 20,
        spacingHorizontal: 120,
        duration: 500,
        maxWidth: 300,
        initialExpandLevel: 3,
      });

      // Render the mind map
      mm.setData(data);
      mm.fit();

      // Handle node clicks (send message to React Native)
      svg.addEventListener("click", (e) => {
        // Find the clicked g element (node group)
        let target = e.target;
        while (target && target.tagName !== "g") {
          target = target.parentElement;
        }

        // Check if it's a markmap node
        if (target && target.classList.contains("markmap-node")) {
          const nodeData = target.__data__;
          console.log("Node clicked:", nodeData);

          if (nodeData?.data?.payload?.link) {
            console.log("Navigating to:", nodeData.data.payload.link);
            if (window.ReactNativeWebView) {
              window.ReactNativeWebView.postMessage(
                JSON.stringify({
                  type: "navigate",
                  link: nodeData.data.payload.link,
                })
              );
            }
          }
        }
      });

      // Auto-fit on window resize
      window.addEventListener("resize", () => {
        mm.fit();
      });
    </script>
  </body>
</html>
